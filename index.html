<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Timesheet Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const TimesheetTracker = () => {
          const [numWorkers, setNumWorkers] = useState(4);
          const [numProjects, setNumProjects] = useState(2);
          const [workers, setWorkers] = useState(['Worker 1', 'Worker 2', 'Worker 3', 'Worker 4']);
          const [projects, setProjects] = useState(['Project A', 'Project B']);
          const [showConfig, setShowConfig] = useState(true);
          const [showWorkerNames, setShowWorkerNames] = useState(false);
          const [showProjectNames, setShowProjectNames] = useState(false);
          const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          
          const [weekEndingDate, setWeekEndingDate] = useState('');
          
          const [rates, setRates] = useState(() => {
            const initial = {};
            workers.forEach(worker => {
              initial[worker] = '';
            });
            return initial;
          });

          const [ratesDisplay, setRatesDisplay] = useState(() => {
            const initial = {};
            workers.forEach(worker => {
              initial[worker] = '';
            });
            return initial;
          });
          
          const [hours, setHours] = useState(() => {
            const initial = {};
            workers.forEach(worker => {
              initial[worker] = {};
              days.forEach(day => {
                initial[worker][day] = {};
                projects.forEach(project => {
                  initial[worker][day][project] = '';
                });
              });
            });
            return initial;
          });

          useEffect(() => {
            const newWorkers = Array.from({ length: numWorkers }, (_, i) => 
              workers[i] || `Worker ${i + 1}`
            );
            setWorkers(newWorkers);
            
            const newRates = {};
            newWorkers.forEach(worker => {
              newRates[worker] = rates[worker] || '';
            });
            setRates(newRates);
            
            const newRatesDisplay = {};
            newWorkers.forEach(worker => {
              newRatesDisplay[worker] = ratesDisplay[worker] || '';
            });
            setRatesDisplay(newRatesDisplay);
            
            const newHours = {};
            newWorkers.forEach(worker => {
              newHours[worker] = {};
              days.forEach(day => {
                newHours[worker][day] = {};
                projects.forEach(project => {
                  newHours[worker][day][project] = (hours[worker]?.[day]?.[project]) || '';
                });
              });
            });
            setHours(newHours);
          }, [numWorkers]);

          useEffect(() => {
            const newProjects = Array.from({ length: numProjects }, (_, i) => 
              projects[i] || String.fromCharCode(65 + i)
            );
            setProjects(newProjects);
            
            const newHours = {};
            workers.forEach(worker => {
              newHours[worker] = {};
              days.forEach(day => {
                newHours[worker][day] = {};
                newProjects.forEach(project => {
                  newHours[worker][day][project] = (hours[worker]?.[day]?.[project]) || '';
                });
              });
            });
            setHours(newHours);
          }, [numProjects]);

          const handleWorkerNameChange = (index, newName) => {
            const oldName = workers[index];
            const newWorkers = [...workers];
            newWorkers[index] = newName;
            setWorkers(newWorkers);
            
            const newRates = { ...rates };
            if (oldName !== newName) {
              newRates[newName] = newRates[oldName] || '';
              delete newRates[oldName];
            }
            setRates(newRates);
            
            const newRatesDisplay = { ...ratesDisplay };
            if (oldName !== newName) {
              newRatesDisplay[newName] = newRatesDisplay[oldName] || '';
              delete newRatesDisplay[oldName];
            }
            setRatesDisplay(newRatesDisplay);
            
            const newHours = { ...hours };
            if (oldName !== newName) {
              newHours[newName] = newHours[oldName] || {};
              delete newHours[oldName];
            }
            setHours(newHours);
          };

          const handleProjectNameChange = (index, newName) => {
            const oldName = projects[index];
            const newProjects = [...projects];
            newProjects[index] = newName;
            setProjects(newProjects);
            
            const newHours = { ...hours };
            workers.forEach(worker => {
              if (newHours[worker]) {
                days.forEach(day => {
                  if (newHours[worker][day] && oldName !== newName) {
                    newHours[worker][day][newName] = newHours[worker][day][oldName] || '';
                    delete newHours[worker][day][oldName];
                  }
                });
              }
            });
            setHours(newHours);
          };

          const handleDateChange = (value) => {
            if (value) {
              const selectedDate = new Date(value + 'T00:00:00');
              const dayOfWeek = selectedDate.getDay();
              
              if (dayOfWeek === 6) {
                setWeekEndingDate(value);
              } else {
                const daysUntilSaturday = (6 - dayOfWeek + 7) % 7;
                const saturday = new Date(selectedDate);
                saturday.setDate(saturday.getDate() + daysUntilSaturday);
                
                const saturdayString = saturday.toISOString().split('T')[0];
                setWeekEndingDate(saturdayString);
              }
            } else {
              setWeekEndingDate(value);
            }
          };

          const handleHourChange = (worker, day, project, value) => {
            const numValue = value === '' ? '' : parseFloat(value);
            if (value === '' || (!isNaN(numValue) && numValue >= 0)) {
              setHours(prev => ({
                ...prev,
                [worker]: {
                  ...prev[worker],
                  [day]: {
                    ...prev[worker][day],
                    [project]: value
                  }
                }
              }));
            }
          };

          const handleRateChange = (worker, value) => {
            const cleanValue = value.replace(/[^\d]/g, '');
            
            if (cleanValue === '') {
              setRates(prev => ({
                ...prev,
                [worker]: ''
              }));
              setRatesDisplay(prev => ({
                ...prev,
                [worker]: ''
              }));
            } else {
              const numValue = parseInt(cleanValue);
              if (!isNaN(numValue) && numValue >= 0) {
                setRates(prev => ({
                  ...prev,
                  [worker]: cleanValue
                }));
                setRatesDisplay(prev => ({
                  ...prev,
                  [worker]: numValue.toLocaleString('en-US')
                }));
              }
            }
          };

          const formatCurrency = (value) => {
            return Math.round(value).toLocaleString('en-US');
          };

          const calculateDailyTotal = (worker, day) => {
            return projects.reduce((sum, project) => {
              const value = parseFloat(hours[worker][day][project]) || 0;
              return sum + value;
            }, 0);
          };

          const calculateWorkerTotal = (worker) => {
            return days.reduce((sum, day) => {
              return sum + calculateDailyTotal(worker, day);
            }, 0);
          };

          const calculatePayout = (worker) => {
            const totalHours = calculateWorkerTotal(worker);
            const rate = parseFloat(rates[worker]) || 0;
            return totalHours * rate;
          };

          const calculateDayProjectTotal = (day, project) => {
            return workers.reduce((sum, worker) => {
              const value = parseFloat(hours[worker][day][project]) || 0;
              return sum + value;
            }, 0);
          };

          const calculateProjectTotalHours = (project) => {
            return days.reduce((sum, day) => {
              return sum + calculateDayProjectTotal(day, project);
            }, 0);
          };

          const calculateProjectTotalCost = (project) => {
            return workers.reduce((sum, worker) => {
              const rate = parseFloat(rates[worker]) || 0;
              const projectHours = days.reduce((hrs, day) => {
                const value = parseFloat(hours[worker][day][project]) || 0;
                return hrs + value;
              }, 0);
              return sum + (projectHours * rate);
            }, 0);
          };

          const calculateDayTotal = (day) => {
            return workers.reduce((sum, worker) => {
              return sum + calculateDailyTotal(worker, day);
            }, 0);
          };

          const calculateGrandTotal = () => {
            return workers.reduce((sum, worker) => sum + calculateWorkerTotal(worker), 0);
          };

          const calculateTotalPayout = () => {
            return workers.reduce((sum, worker) => sum + calculatePayout(worker), 0);
          };

          const saveTimesheet = () => {
            const timesheetData = {
              numWorkers,
              numProjects,
              workers,
              projects,
              weekEndingDate,
              rates,
              ratesDisplay,
              hours
            };
            const dataStr = JSON.stringify(timesheetData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `timesheet_${weekEndingDate || 'backup'}.json`;
            link.click();
            URL.revokeObjectURL(url);
          };

          const loadTimesheet = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const data = JSON.parse(e.target.result);
                  setNumWorkers(data.numWorkers || 4);
                  setNumProjects(data.numProjects || 2);
                  setWorkers(data.workers || []);
                  setProjects(data.projects || []);
                  setWeekEndingDate(data.weekEndingDate || '');
                  setRates(data.rates || {});
                  setRatesDisplay(data.ratesDisplay || {});
                  setHours(data.hours || {});
                  alert('Timesheet loaded successfully!');
                } catch (error) {
                  alert('Error loading timesheet. Please check the file format.');
                }
              };
              reader.readAsText(file);
            }
            event.target.value = '';
          };

          return (
            <div className="p-6 bg-gray-50 min-h-screen">
              <style>
                {`
                  input[type=number]::-webkit-inner-spin-button,
                  input[type=number]::-webkit-outer-spin-button {
                    -webkit-appearance: none;
                    margin: 0;
                  }
                  input[type=number] {
                    -moz-appearance: textfield;
                  }
                `}
              </style>
              <div className="mb-6 bg-white rounded-lg shadow-md p-4">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-bold text-gray-800">Timesheet Configuration</h2>
                  <div className="flex gap-2">
                    <button
                      onClick={saveTimesheet}
                      className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition font-semibold"
                    >
                      ðŸ’¾ Save Timesheet
                    </button>
                    <label className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-semibold cursor-pointer">
                      ðŸ“‚ Load Timesheet
                      <input
                        type="file"
                        accept=".json"
                        onChange={loadTimesheet}
                        className="hidden"
                      />
                    </label>
                    <button
                      onClick={() => setShowConfig(!showConfig)}
                      className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition font-semibold"
                    >
                      {showConfig ? 'Hide Configuration' : 'Show Configuration'}
                    </button>
                  </div>
                </div>
                
                {showConfig && (
                  <>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                      <div>
                        <div className="flex items-center gap-2 mb-2">
                          <label className="font-semibold text-gray-700 flex-1">Number of Workers:</label>
                          <button
                            onClick={() => setShowWorkerNames(!showWorkerNames)}
                            className="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition text-sm"
                          >
                            {showWorkerNames ? 'â–¼ Hide Names' : 'â–¶ Edit Names'}
                          </button>
                        </div>
                        <input
                          type="number"
                          min="1"
                          max="20"
                          value={numWorkers}
                          onFocus={(e) => {
                            e.target.select();
                            setTimeout(() => e.target.select(), 0);
                          }}
                          onClick={(e) => e.target.select()}
                          onChange={(e) => setNumWorkers(Math.max(1, Math.min(20, parseInt(e.target.value) || 1)))}
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3"
                        />
                        
                        {showWorkerNames && (
                          <div className="space-y-2">
                            {workers.map((worker, index) => (
                              <input
                                key={index}
                                type="text"
                                value={worker}
                                onChange={(e) => handleWorkerNameChange(index, e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder={`Worker ${index + 1}`}
                              />
                            ))}
                          </div>
                        )}
                      </div>

                      <div>
                        <div className="flex items-center gap-2 mb-2">
                          <label className="font-semibold text-gray-700 flex-1">Number of Projects:</label>
                          <button
                            onClick={() => setShowProjectNames(!showProjectNames)}
                            className="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition text-sm"
                          >
                            {showProjectNames ? 'â–¼ Hide Names' : 'â–¶ Edit Names'}
                          </button>
                        </div>
                        <input
                          type="number"
                          min="1"
                          max="26"
                          value={numProjects}
                          onFocus={(e) => {
                            e.target.select();
                            setTimeout(() => e.target.select(), 0);
                          }}
                          onClick={(e) => e.target.select()}
                          onChange={(e) => setNumProjects(Math.max(1, Math.min(26, parseInt(e.target.value) || 1)))}
                          className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3"
                        />
                        
                        {showProjectNames && (
                          <div className="space-y-2">
                            {projects.map((project, index) => (
                              <input
                                key={index}
                                type="text"
                                value={project}
                                onChange={(e) => handleProjectNameChange(index, e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder={`Project ${String.fromCharCode(65 + index)}`}
                              />
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                    
                    <div className="mt-4">
                      <label className="block font-semibold text-gray-700 mb-2">Week Ending Date:</label>
                      <input
                        type="date"
                        value={weekEndingDate}
                        onChange={(e) => handleDateChange(e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>
                  </>
                )}
                
                {weekEndingDate && (
                  <div className="text-center p-2 bg-blue-50 rounded mt-4">
                    <span className="text-lg font-semibold text-blue-700">
                      Week Ending: {new Date(weekEndingDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
                    </span>
                  </div>
                )}
              </div>

              <h1 className="text-3xl font-bold mb-6 text-gray-800">Weekly Timesheet Tracker</h1>
              
              <div className="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <table className="w-full border-collapse text-sm">
                  <thead>
                    <tr className="bg-gray-200">
                      <th className="border border-gray-400 px-3 py-2 text-left font-bold" rowSpan="2">Worker</th>
                      <th className="border border-gray-400 px-3 py-2 text-center font-bold" rowSpan="2">Rate (â‚¡/hr)</th>
                      {days.map(day => (
                        <th key={day} className="border border-gray-400 px-2 py-2 text-center font-bold" colSpan={projects.length}>
                          {day}
                        </th>
                      ))}
                      <th className="border border-gray-400 px-3 py-2 text-center font-bold bg-blue-100" rowSpan="2">
                        Total Hours
                      </th>
                      <th className="border border-gray-400 px-3 py-2 text-center font-bold bg-green-100" rowSpan="2